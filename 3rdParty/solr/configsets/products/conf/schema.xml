<?xml version="1.0" encoding="UTF-8" ?>
<schema name="products" version="1.6">
  <!-- Field types -->
  <fieldType name="string" class="solr.StrField" sortMissingLast="true" docValues="true"/>
  <fieldType name="strings" class="solr.StrField" sortMissingLast="true" multiValued="true" docValues="true"/>
  <fieldType name="boolean" class="solr.BoolField" sortMissingLast="true"/>
  <fieldType name="booleans" class="solr.BoolField" sortMissingLast="true" multiValued="true"/>
  <fieldType name="pint" class="solr.IntPointField" docValues="true"/>
  <fieldType name="pfloat" class="solr.FloatPointField" docValues="true"/>
  <fieldType name="plong" class="solr.LongPointField" docValues="true"/>
  <fieldType name="pdouble" class="solr.DoublePointField" docValues="true"/>
  <fieldType name="pdate" class="solr.DatePointField" docValues="true"/>

  <!-- Text field with English analysis -->
  <fieldType name="text_en" class="solr.TextField" positionIncrementGap="100">
    <analyzer type="index">
      <tokenizer class="solr.StandardTokenizerFactory"/>
      <filter class="solr.StopFilterFactory" ignoreCase="true" words="lang/stopwords_en.txt"/>
      <filter class="solr.LowerCaseFilterFactory"/>
      <filter class="solr.EnglishPossessiveFilterFactory"/>
      <filter class="solr.PorterStemFilterFactory"/>
    </analyzer>
    <analyzer type="query">
      <tokenizer class="solr.StandardTokenizerFactory"/>
      <filter class="solr.StopFilterFactory" ignoreCase="true" words="lang/stopwords_en.txt"/>
      <filter class="solr.LowerCaseFilterFactory"/>
      <filter class="solr.EnglishPossessiveFilterFactory"/>
      <filter class="solr.PorterStemFilterFactory"/>
    </analyzer>
  </fieldType>

  <!-- Text field for general searching with NGram for partial matches -->
  <fieldType name="text_general" class="solr.TextField" positionIncrementGap="100">
    <analyzer type="index">
      <tokenizer class="solr.StandardTokenizerFactory"/>
      <filter class="solr.LowerCaseFilterFactory"/>
    </analyzer>
    <analyzer type="query">
      <tokenizer class="solr.StandardTokenizerFactory"/>
      <filter class="solr.LowerCaseFilterFactory"/>
    </analyzer>
  </fieldType>

  <!-- Autocomplete field type with edge n-grams -->
  <fieldType name="text_autocomplete" class="solr.TextField" positionIncrementGap="100">
    <analyzer type="index">
      <tokenizer class="solr.StandardTokenizerFactory"/>
      <filter class="solr.LowerCaseFilterFactory"/>
      <filter class="solr.EdgeNGramFilterFactory" minGramSize="2" maxGramSize="15"/>
    </analyzer>
    <analyzer type="query">
      <tokenizer class="solr.StandardTokenizerFactory"/>
      <filter class="solr.LowerCaseFilterFactory"/>
    </analyzer>
  </fieldType>

  <!-- Unique key field -->
  <field name="id" type="string" indexed="true" stored="true" required="true" multiValued="false"/>
  <uniqueKey>id</uniqueKey>

  <!-- Core product fields -->
  <field name="sku" type="string" indexed="true" stored="true"/>
  <field name="name" type="text_en" indexed="true" stored="true"/>
  <field name="name_autocomplete" type="text_autocomplete" indexed="true" stored="false"/>
  <field name="name_sort" type="string" indexed="true" stored="false" docValues="true"/>
  <field name="description" type="text_en" indexed="true" stored="true"/>
  <field name="price" type="pfloat" indexed="true" stored="true" docValues="true"/>
  <field name="currency" type="string" indexed="true" stored="true"/>
  <field name="category" type="string" indexed="true" stored="true" docValues="true"/>
  <field name="stock" type="pint" indexed="true" stored="true" docValues="true"/>
  <field name="images" type="strings" indexed="false" stored="true"/>

  <!-- Attribute fields for faceting -->
  <field name="woodType" type="string" indexed="true" stored="true" docValues="true"/>
  <field name="finish" type="string" indexed="true" stored="true" docValues="true"/>
  <field name="dimensions" type="string" indexed="true" stored="true"/>
  <field name="grade" type="string" indexed="true" stored="true" docValues="true"/>
  <field name="type" type="string" indexed="true" stored="true" docValues="true"/>
  <field name="material" type="string" indexed="true" stored="true" docValues="true"/>
  <field name="brand" type="string" indexed="true" stored="true" docValues="true"/>
  <field name="packSize" type="string" indexed="true" stored="true" docValues="true"/>
  <field name="size" type="string" indexed="true" stored="true" docValues="true"/>
  <field name="power" type="string" indexed="true" stored="true"/>

  <!-- Catch-all field for general search -->
  <field name="text" type="text_general" indexed="true" stored="false" multiValued="true"/>

  <!-- Copy fields for search -->
  <copyField source="name" dest="name_autocomplete"/>
  <copyField source="name" dest="name_sort"/>
  <copyField source="name" dest="text"/>
  <copyField source="description" dest="text"/>
  <copyField source="sku" dest="text"/>
  <copyField source="category" dest="text"/>
  <copyField source="woodType" dest="text"/>
  <copyField source="brand" dest="text"/>
  <copyField source="material" dest="text"/>

  <!-- Version field for optimistic concurrency -->
  <field name="_version_" type="plong" indexed="false" stored="false"/>

  <!-- Dynamic fields for any extra attributes -->
  <dynamicField name="*_s" type="string" indexed="true" stored="true"/>
  <dynamicField name="*_ss" type="strings" indexed="true" stored="true"/>
  <dynamicField name="*_i" type="pint" indexed="true" stored="true"/>
  <dynamicField name="*_f" type="pfloat" indexed="true" stored="true"/>
  <dynamicField name="*_b" type="boolean" indexed="true" stored="true"/>
  <dynamicField name="*_t" type="text_general" indexed="true" stored="true"/>
</schema>
